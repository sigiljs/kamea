!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Kamea=e():t.Kamea=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="/",e(0)}([function(t,e,n){"use strict";function r(t,e){this._name=t,this._actions={},this._store=e,this.state=e.state[t],this._commit=this._commit.bind(this)}function i(){this._freezer=new s({}),this.state=this._freezer.get(),this._domains={},this._subscribers=[]}var s=n(1);r.prototype._commit=function(t){this._store.state[this._name].transact(),t(this._store.state[this._name],this._store.state),this._store.state[this._name].run(),this._store._commit()},r.prototype.dispatch=function(t){this._actions[t.type]&&(this._store.state[this._name].transact(),this._actions[t.type](this._store.state[this._name],t,this._commit,this._store.state),this._store.state[this._name].run())},r.prototype.action=function(t,e){this._actions[t]=e},i.prototype._publishNewState=function(t){this.state=t;for(var e in this._domains)this._domains[e].state=t[e];for(var e=0;e<this._subscribers.length;e++)this._subscribers[e]()},i.prototype._commit=function(){this.state.run();var t=this._freezer.get();this.state!=t&&this._publishNewState(t)},i.prototype.subscribe=function(t){this._subscribers.push(t)},i.prototype.domain=function(t,e){this.state=this.state.set(t,e);var n=new r(t,this);return this._domains[t]=n,n},i.prototype.dispatch=function(t){for(var e in this._domains)this._domains[e].dispatch(t),this._commit()},t.exports=i},function(t,e,n){var r=n(2);t.exports=r},function(t,e,n){"use strict";var r=n(3),i=(n(4),n(5)),s=function(t,e){var n,s=this,o=e||{},a={live:o.live||!1,freezeInstances:o.freezeInstances||!1},c=[],f=0,u=function(t){var e,n=t.__;if(n.listener){var r=n.listener.prevState||t;n.listener.prevState=0,i.trigger(r,"update",t,!0)}for(e=0;e<n.parents.length;e++)n.store.notify("now",n.parents[e])},h=function(t){c.push(t),f||(f=1,r.nextTick(function(){c=[],f=0}))};a.notify=function(t,e,n){if("now"==t){if(c.length)for(;c.length;)u(c.shift());else u(e);return e}var s=i[t](e,n);if("pivot"!=t){var o=r.findPivot(s);if(o)return h(s),o}return s},a.freezeFn=o.mutable===!0?function(){}:function(t){Object.freeze(t)},n=i.freeze(t,a),n.__.updateRoot=function(t,e){t===n&&(n=e)};var _=n.getListener(),p={};r.each(["on","off","once","trigger"],function(t){var e={};e[t]=_[t].bind(_),r.addNE(s,e),r.addNE(p,e)}),r.addNE(this,{get:function(){return n},set:function(t){n.reset(t)},getEventHub:function(){return p}}),r.addNE(this,{getData:this.get,setData:this.set})};t.exports=s},function(t,e){"use strict";var n=new Function("return this")(),r={extend:function(t,e){for(var n in e)t[n]=e[n];return t},createNonEnumerable:function(t,e){var n={};for(var r in t)n[r]={value:t[r]};return Object.create(e||{},n)},error:function(t){var e=new Error(t);if(console)return console.error(e);throw e},each:function(t,e){var n,r,i;if(t&&t.constructor==Array)for(n=0,r=t.length;n<r;n++)e(t[n],n);else for(i=Object.keys(t),n=0,r=i.length;n<r;n++)e(t[i[n]],i[n])},addNE:function(t,e){for(var n in e)Object.defineProperty(t,n,{enumerable:!1,configurable:!0,writable:!0,value:e[n]})},createNE:function(t){var e={};for(var n in t)e[n]={writable:!0,configurable:!0,enumerable:!1,value:t[n]};return e},nextTick:function(){function t(){for(;r=i.shift();)r();s=!1}function e(t){i.push(t),s||(s=!0,c())}var r,i=[],s=!1,o=!!n.postMessage&&"undefined"!=typeof Window&&n instanceof Window,a="nexttick",c=function(){return o?function(){n.postMessage(a,"*")}:function(){setTimeout(function(){f()},0)}}(),f=function(){return o?function(e){e.source===n&&e.data===a&&(e.stopPropagation(),t())}:t}();return o&&n.addEventListener("message",f,!0),e.removeListener=function(){n.removeEventListener("message",f,!0)},e}(),findPivot:function(t){if(t&&t.__){if(t.__.pivot)return t;for(var e,n=0,r=t.__.parents,i=0;!n&&i<r.length;)e=r[i],e.__.pivot&&(n=e),i++;if(n)return n;for(i=0;!n&&i<r.length;)n=this.findPivot(r[i]),i++;return n}},isLeaf:function(t,e){var n;return!t||!(n=t.constructor)||(e?n===String||n===Number||n===Boolean:n!=Object&&n!=Array)}};t.exports=r},function(t,e,n){"use strict";var r=n(3),i="beforeAll",s="afterAll",o=[i,s],a={on:function(t,e,n){var r=this._events[t]||[];return r.push({callback:e,once:n}),this._events[t]=r,this},once:function(t,e){return this.on(t,e,!0)},off:function(t,e){if("undefined"==typeof t)this._events={};else if("undefined"==typeof e)this._events[t]=[];else{var n,r=this._events[t]||[];for(n=r.length-1;n>=0;n--)r[n].callback===e&&r.splice(n,1)}return this},trigger:function(t){var e,n,r,a,c=[].slice.call(arguments,1),f=this._events[t]||[],u=[],h=o.indexOf(t)!=-1;for(h||this.trigger.apply(this,[i,t].concat(c)),e=0;e<f.length;e++)n=f[e],n.callback?a=n.callback.apply(this,c):n.once=!0,n.once&&u.push(e),void 0!==a&&(r=a);for(e=u.length-1;e>=0;e--)f.splice(u[e],1);return h||this.trigger.apply(this,[s,t].concat(c)),r}},c=r.createNonEnumerable(a);t.exports=c},function(t,e,n){"use strict";var r=n(3),i=n(6),s=n(4),o={freeze:function(t,e){if(t&&t.__)return t;var n=this,s=i.clone(t);return r.addNE(s,{__:{listener:!1,parents:[],store:e}}),r.each(t,function(t,i){r.isLeaf(t,e.freezeInstances)||(t=n.freeze(t,e)),t&&t.__&&n.addParent(t,s),s[i]=t}),e.freezeFn(s),s},merge:function(t,e){var n=t.__,i=n.trans,e=r.extend({},e);if(i){for(var s in e)i[s]=e[s];return t}var o,a,c,f=this,u=this.copyMeta(t),h=n.store;r.each(t,function(n,i){return c=n&&n.__,c&&f.removeParent(n,t),(o=e[i])?(r.isLeaf(o,h.freezeInstances)||(o=f.freeze(o,h)),o&&o.__&&f.addParent(o,u),delete e[i],void(u[i]=o)):(c&&f.addParent(n,u),u[i]=n)});for(a in e)o=e[a],r.isLeaf(o,h.freezeInstances)||(o=f.freeze(o,h)),o&&o.__&&f.addParent(o,u),u[a]=o;return n.store.freezeFn(u),this.refreshParents(t,u),u},replace:function(t,e){var n=this,i=t.__,s=e;return r.isLeaf(e,i.store.freezeInstances)||(s=n.freeze(e,i.store),s.__.parents=i.parents,s.__.updateRoot=i.updateRoot,i.listener&&(s.__.listener=i.listener)),s&&this.fixChildren(s,t),this.refreshParents(t,s),s},remove:function(t,e){var n=t.__.trans;if(n){for(var i=e.length-1;i>=0;i--)delete n[e[i]];return t}var s,o=this,a=this.copyMeta(t);return r.each(t,function(n,r){s=n&&n.__,s&&o.removeParent(n,t),e.indexOf(r)==-1&&(s&&o.addParent(n,a),a[r]=n)}),t.__.store.freezeFn(a),this.refreshParents(t,a),a},splice:function(t,e){var n=t.__,i=n.trans;if(i)return i.splice.apply(i,e),t;var s,o=this,a=this.copyMeta(t),c=e[0],f=c+e[1];if(r.each(t,function(e,n){e&&e.__&&(o.removeParent(e,t),(n<c||n>=f)&&o.addParent(e,a)),a[n]=e}),e.length>1)for(var u=e.length-1;u>=2;u--)s=e[u],r.isLeaf(s,n.store.freezeInstances)||(s=this.freeze(s,n.store)),s&&s.__&&this.addParent(s,a),e[u]=s;return Array.prototype.splice.apply(a,e),n.store.freezeFn(a),this.refreshParents(t,a),a},transact:function(t){var e,n=this,i=t.__.trans;return i?i:(e=t.constructor==Array?[]:{},r.each(t,function(t,n){e[n]=t}),t.__.trans=e,r.nextTick(function(){t.__.trans&&n.run(t)}),e)},run:function(t){var e=this,n=t.__.trans;if(!n)return t;r.each(n,function(n,r){n&&n.__&&e.removeParent(n,t)}),delete t.__.trans;var i=this.replace(t,n);return i},pivot:function(t){return t.__.pivot=1,this.unpivot(t),t},unpivot:function(t){r.nextTick(function(){t.__.pivot=0})},refresh:function(t,e,n){var i=this,s=t.__.trans,o=0;if(s)return r.each(s,function(r,a){o||r===e&&(s[a]=n,o=1,n&&n.__&&i.addParent(n,t))}),t;var a,c=this.copyMeta(t);r.each(t,function(r,s){r===e&&(r=n),r&&(a=r.__)&&(i.removeParent(r,t),i.addParent(r,c)),c[s]=r}),t.__.store.freezeFn(c),this.refreshParents(t,c)},fixChildren:function(t,e){var n=this;r.each(t,function(r){if(r&&r.__){if(n.fixChildren(r),1==r.__.parents.length)return r.__.parents=[t];e&&n.removeParent(r,e),n.addParent(r,t)}})},copyMeta:function(t){var e=i.clone(t),n=t.__;return r.addNE(e,{__:{store:n.store,updateRoot:n.updateRoot,listener:n.listener,parents:n.parents.slice(0),trans:n.trans,pivot:n.pivot}}),n.pivot&&this.unpivot(e),e},refreshParents:function(t,e){var n,r=t.__,i=r.parents.length;if(t.__.updateRoot&&t.__.updateRoot(t,e),e&&this.trigger(t,"update",e,r.store.live),i)for(n=i-1;n>=0;n--)this.refresh(r.parents[n],t,e)},removeParent:function(t,e){var n=t.__.parents,r=n.indexOf(e);r!=-1&&n.splice(r,1)},addParent:function(t,e){var n=t.__.parents,r=n.indexOf(e);r==-1&&(n[n.length]=e)},trigger:function(t,e,n,i){var s=t.__.listener;if(s){var o=s.ticking;if(i)return void((o||n)&&(s.ticking=0,s.trigger(e,o||n,t)));s.ticking=n,s.prevState||(s.prevState=t),o||r.nextTick(function(){if(s.ticking){var n=s.ticking;s.prevState;s.ticking=0,s.prevState=0,s.trigger(e,n,t)}})}},createListener:function(t){var e=t.__.listener;return e||(e=Object.create(s,{_events:{value:{},writable:!0}}),t.__.listener=e),e}};i.init(o),t.exports=o},function(t,e,n){"use strict";var r=n(3),i={init:function(t){var e={set:function(t,e){var n=t,i=this.__.trans;if("object"!=typeof t&&(n={},n[t]=e),!i){for(var s in n)i=i||this[s]!==n[s];if(!i)return r.findPivot(this)||this}return this.__.store.notify("merge",this,n)},reset:function(t){return this.__.store.notify("replace",this,t)},getListener:function(){return t.createListener(this)},toJS:function(){var t;return t=this.constructor==Array?new Array(this.length):{},r.each(this,function(e,n){e&&e.__?t[n]=e.toJS():t[n]=e}),t},transact:function(){return this.__.store.notify("transact",this)},run:function(){return this.__.store.notify("run",this)},now:function(){return this.__.store.notify("now",this)},pivot:function(){return this.__.store.notify("pivot",this)}},n=r.extend({push:function(t){return this.append([t])},append:function(t){return t&&t.length?this.__.store.notify("splice",this,[this.length,0].concat(t)):this},pop:function(){return this.length?this.__.store.notify("splice",this,[this.length-1,1]):this},unshift:function(t){return this.prepend([t])},prepend:function(t){return t&&t.length?this.__.store.notify("splice",this,[0,0].concat(t)):this},shift:function(){return this.length?this.__.store.notify("splice",this,[0,1]):this},splice:function(t,e,n){return this.__.store.notify("splice",this,arguments)}},e),i=Object.create(Array.prototype,r.createNE(n)),s=r.createNE(r.extend({remove:function(t){var e=[],n=t;t.constructor!=Array&&(n=[t]);for(var r=0,i=n.length;r<i;r++)this.hasOwnProperty(n[r])&&e.push(n[r]);return e.length?this.__.store.notify("remove",this,e):this}},e)),o=Object.create(Object.prototype,s),a=function(){return[].__proto__?function(t){var e=new Array(t);return e.__proto__=i,e}:function(t){var e=new Array(t);for(var r in n)e[r]=n[r];return e}}();this.clone=function(t){var e=t.constructor;return e==Array?a(t.length):e===Object?Object.create(o):Object.create(e.prototype,s)}}};t.exports=i}])});